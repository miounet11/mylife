// 大师话术库
export const MasterPhrases = {
  // 开头话术
  openings: [
    '细观您的八字，命理之象，历历在目。',
    '从您的八字来看，命局清奇，格局分明，乃富贵之命也。',
    '细究您的命局，五行配置得当，十神分布有序，此乃上佳之命局。',
    '观您之八字，日主得令而旺，格局清正，主事业有成，财运亨通。',
    '从您的命盘来看，四柱五行相生有情，十神分布得宜，乃富贵之格。',
  ],

  // 描述话术
  descriptions: [
    '乃富贵之命也',
    '格局清奇，主事业有成，权力在握',
    '五行相生有情，主福寿绵长',
    '日主得令而旺，如日中天，光芒万丈',
    '年月日时四柱，如四根擎天，稳如泰山',
    '年柱吉神照临，祖上庇佑',
    '月令提纲得用，父母有助',
    '夫妻宫有情，婚姻美满',
    '子女宫吉神，子孙满堂',
  ],

  // 判断话术
  judgments: [
    '主事业有成，权力在握',
    '主财运亨通，财富日增',
    '主婚姻美满，白头偕老',
    '主子女成才，光宗耀祖',
    '主健康平安，福寿绵长',
    '主贵人相助，事业顺利',
    '主学业有成，名列前茅',
  ],

  // 时间话术
  timing: [
    '近期运势上升',
    '下半年事业起',
    '未来三年大运',
    '2024-2026年上升期',
    '甲辰年大吉大利',
    '未来五年黄金期',
    '乙巳年事业巅峰',
    '丙午年财运亨通',
  ],

  // 建议话术
  advice: [
    '宜往南方发展',
    '宜穿红紫衣物',
    '宜与属猴人合作',
    '宜从事管理行业',
    '宜创业经商',
    '宜投资理财',
    '宜学习进修',
    '宜把握时机',
    '忌赌博投机',
    '忌与属龙人冲突',
    '忌冲动决策',
    '忌大额投资',
  ],

  // 结尾话术
  closing: [
    '愿您事业有成，家庭幸福。',
    '望您善用命理优势，把握时机。',
    '顺天应命，趋吉避凶，必有大成。',
    '命理虽定，人定胜天，勤勉努力。',
    '愿您福慧双修，事业爱情双丰收。',
    '望您顺天应命，大展宏图。',
  ],

  // 古籍引用
  ancientQuotes: [
    '《三命通会》云："命理之学，非凭空臆测，乃观天察地，究天人之际。"',
    '《滴天髓》云："十干统运，不外乎中和二字。"',
    '《子平真诠》云："命之真机，在于中和。"',
    '《穷通宝鉴》云："格局者，命之总纲也。"',
    '《渊海子平》云："吉神为命之辅佐，吉则吉，凶则凶。"',
    '《三命通会》云："五行得令，无往不利。"',
    '《滴天髓》云："甲木参天，脱胎要火。春不容金，秋不容土。"',
  ],

  // 五行描述
  fiveElements: {
    wood: {
      strong: '木旺，性格刚毅，有领导力，做事果断',
      weak: '木弱，性格温和，有同情心，善解人意',
      description: '木主仁，代表生长、发展、仁爱',
      masterLanguage: '日主为木，主仁爱之心，待人友善，有领导才能',
    },
    fire: {
      strong: '火旺，热情开朗，有活力，善于表达',
      weak: '火弱，内敛保守，不善言辞',
      description: '火主礼，代表热情、礼貌、光明',
      masterLanguage: '日主为火，主热情好客，善于交际，人缘好',
    },
    earth: {
      strong: '土旺，稳重踏实，可靠诚信，做事有计划',
      weak: '土弱，缺乏安全感，容易焦虑',
      description: '土主信，代表稳重、诚实、可靠',
      masterLanguage: '日主为土，主诚信稳重，做事踏实，值得信赖',
    },
    metal: {
      strong: '金旺，果断坚毅，有决断力，执行力强',
      weak: '金弱，优柔寡断，缺乏决断',
      description: '金主义，代表决断、正义、刚毅',
      masterLanguage: '日主为金，主果断决断，有正义感，执行力强',
    },
    water: {
      strong: '水旺，聪明伶俐，适应力强，反应快',
      weak: '水弱，思维迟缓，学习吃力',
      description: '水主智，代表智慧、适应、流动',
      masterLanguage: '日主为水，主聪明伶俐，适应力强，善于变通',
    },
  },

  // 十神描述
  tenGods: {
    self: {
      name: '自身',
      description: '代表您自己，是八字的根本',
      masterLanguage: '日主为命之本，一生运势皆基于此',
    },
    output: {
      name: '正印、偏印',
      description: '代表长辈、贵人、知识',
      masterLanguage: '印星得用，必得贵人相助，学业有成',
    },
    input: {
      name: '正财、偏财',
      description: '代表财富、物质、妻星',
      masterLanguage: '财星得用，财运亨通，物质丰富',
    },
    control: {
      name: '正官、七杀',
      description: '代表事业、权力、夫星',
      masterLanguage: '官星得用，事业有成，权力在握',
    },
    controlled: {
      name: '伤官、食神',
      description: '代表才华、表现、子女星',
      masterLanguage: '食伤得用，才华横溢，子女满堂',
    },
  },

  // 格局描述
  patterns: {
    zhenge: {
      name: '正格',
      description: '格局清正，主富贵双全',
      masterLanguage: '此乃正格，主事业有成，财运亨通，家庭幸福',
    },
    congsha: {
      name: '从杀格',
      description: '日主从杀，七杀透干',
      masterLanguage: '从杀格，主事业有成，权力在握，贵不可言',
    },
    congcai: {
      name: '从财格',
      description: '日主从财，财星得用',
      masterLanguage: '从财格，主大富大贵，财运亨通，富甲一方',
    },
    congshang: {
      name: '从伤格',
      description: '日主从伤，食神透干',
      masterLanguage: '从伤格，主才华横溢，名扬四海',
    },
    pingzhuan: {
      name: '平头格',
      description: '格局平和，主平稳发展',
      masterLanguage: '此乃平头格，主平稳发展，不急不躁，稳步前进',
    },
  },

  // 大运描述
  dayun: {
    transition: {
      title: '大运转换',
      masterLanguage: '大运转换是人生的重大转折点，宜谨慎行事，把握机遇。',
      advice: '大运转换之期，宜静不宜动，宜守不宜攻，待运势稳定后再做决策。',
    },
    good: {
      title: '大运吉运',
      masterLanguage: '此大运十年，乃您人生黄金期，宜把握机遇，大展宏图。',
      advice: '大运吉运之时，宜进取创业，投资理财，结婚生子，把握时机。',
    },
    bad: {
      title: '大运凶运',
      masterLanguage: '此大运十年，宜保守行事，避免重大决策。',
      advice: '大运凶运之时，宜保守谨慎，避免投资创业，专注提升自身，静待时机。',
    },
  },

  // 流年描述
  liunian: {
    auspicious: {
      title: '流年大吉',
      masterLanguage: '此流年大吉大利，诸事皆宜。',
      advice: '流年大吉，宜结婚生子、开业创业、投资理财、把握机遇。',
    },
    inauspicious: {
      title: '流年不利',
      masterLanguage: '此流年不利，宜谨慎行事。',
      advice: '流年不利，宜保守行事，避免重大决策，注意健康，谨慎财务。',
    },
    normal: {
      title: '流年平稳',
      masterLanguage: '此流年平稳，按部就班。',
      advice: '流年平稳，宜稳步前进，不急不躁，按计划行事。',
    },
  },

  // 事业建议
  career: {
    general: [
      '您的命局适合从政、管理、金融、司法等领域',
      '事业运旺，宜把握机遇，大展宏图',
      '您的格局清奇，主事业有成，权力在握',
      '从您的八字来看，您有领导才能，适合管理岗位',
    ],
    specific: [
      '若您从事管理，2024-2026年是上升期，可争取升职',
      '适合创业，选择火、土相关的行业，如科技、教育、金融',
      '注意与属猴、属鸡的人合作，利于事业发展',
      '不宜与属龙的人产生冲突，不利合作',
      '事业运势在下半年起，2025年达到高峰',
      '近期适合跳槽，有贵人相助',
      '明年大运转换，事业会有重大变化',
    ],
    direction: [
      '南方为事业吉方，可往南方发展',
      '东南方有贵人运，适合寻求合作',
      '西方为事业旺方，适合扩张业务',
    ],
    colors: [
      '宜穿红色、紫色系衣服，利于事业',
      '办公室布置宜用红色、紫色，提升事业运',
      '办公用品宜用红色、紫色，提高工作效率',
    ],
    avoid: [
      '忌与属龙的人合作',
      '忌从事水、金相关的行业',
      '忌赌博投机，宜正职工作',
      '忌冲动决策，宜三思后行',
    ],
  },

  // 财富建议
  wealth: {
    general: [
      '正财得用，财运以正职工作为主，副业为辅',
      '偏财运强，适合投资理财',
      '财星得用，财运亨通，财富日增',
      '您的命局乃富贵之格，主大富大贵',
    ],
    specific: [
      '2024年农历九月、十月财运最旺，适合投资',
      '偏财运在2025年较强，可考虑小额投资',
      '不宜赌博、炒股，正财稳健',
      '正财在2026年最强，适合正职工作',
      '近期有意外之财，但要谨慎处理',
      '明年财运转折点，把握投资机会',
    ],
    direction: [
      '南方为求财吉方，可往南方发展',
      '东南方有贵人运，利于求财',
      '西方为财运旺方，适合投资',
    ],
    colors: [
      '宜穿红色、紫色系衣服，利于招财',
      '钱包、银行卡宜用红色、紫色，提升财运',
      '办公桌宜用红色、紫色，招财进宝',
    ],
    avoid: [
      '忌穿黑色、白色系衣服',
      '忌赌博投机',
      '忌大额投资',
      '忌借钱给他人',
    ],
  },

  // 婚姻建议
  marriage: {
    general: [
      '伤官见财，婚姻稍晚，但晚婚更幸福，配偶贤惠能干',
      '夫妻宫有情，主婚姻美满，白头偕老',
      '配偶宫吉神照临，配偶贤惠，婚姻幸福',
      '您的命局婚姻运旺，宜早婚早育',
    ],
    specific: [
      '2024年下半年有桃花，适合恋爱、结婚',
      '2025年是结婚吉年，宜把握时机',
      '配偶属属猴、属鸡的人，婚姻更美满',
      '不宜与属龙的人结合',
      '婚姻运在下半年起，2025年达到高峰',
      '近期有桃花出现，但要注意辨别',
      '适合与属猴、属鸡的人恋爱结婚',
    ],
    direction: [
      '南方为婚姻吉方，适合恋爱、结婚',
      '东南方有贵人运，利于婚姻',
      '西方为婚姻旺方，适合婚礼',
    ],
    colors: [
      '宜穿红色、粉色系衣服，利于婚姻',
      '婚礼宜用红色、粉色，喜庆吉祥',
      '饰品宜用红色、粉色，招桃花',
    ],
    avoid: [
      '忌与属龙的人恋爱',
      '忌穿黑色、白色系衣服',
      '忌在冲克日结婚',
      '忌在不利方位举办婚礼',
    ],
  },

  // 健康建议
  health: {
    general: [
      '木旺克土，注意脾胃、消化系统，多食黄色食物',
      '火旺克金，注意肺部、呼吸系统，多食白色食物',
      '土旺克水，注意肾脏、泌尿系统，多食黑色食物',
      '金旺克木，注意肝脏、胆部，多食绿色食物',
      '水旺克火，注意心脏、血液系统，多食红色食物',
    ],
    specific: [
      '2024年农历二月注意脾胃健康',
      '2025年注意心脏健康',
      '定期体检，早发现早治疗',
      '多食黄色食物，养脾胃',
      '适当运动，增强体质',
      '避免熬夜，保证睡眠',
    ],
    direction: [
      '东方为健康吉方，适合就医、锻炼',
      '东南方有贵人运，利于健康',
      '北方为健康旺方，适合养生',
    ],
    colors: [
      '黄色食物养脾胃',
      '白色食物养肺',
      '黑色食物养肾',
      '绿色食物养肝',
      '红色食物养心',
    ],
    avoid: [
      '忌熬夜',
      '忌暴饮暴食',
      '忌过度劳累',
      '忌情绪激动',
    ],
  },

  // 化灾建议
  disaster: {
    career: {
      title: '事业化灾',
      masterLanguage: '未来3个月事业运势下滑',
      immediate: [
        '暂缓重大决策',
        '避免与同事冲突',
        '保守行事，不要激进',
        '完成手头工作',
        '储备人际资源',
        '准备B计划',
      ],
      shortTerm: [
        '提升自身能力',
        '建立人脉网络',
        '寻找新机会',
        '参加培训学习',
        '主动出击，不坐等机会',
      ],
      longTerm: [
        '建立个人品牌',
        '积累行业资源',
        '提升专业技能',
        '考取相关证书',
        '建立长期合作关系',
      ],
      fortuneEnhancements: {
        rituals: [
          '佩戴紫水晶',
          '拜文昌帝君',
          '挂红色中国结',
        ],
        amulets: [
          '开运貔貅',
          '文昌笔',
          '事业印',
        ],
        colors: ['红色', '紫色'],
        directions: ['南方', '东南方'],
        dates: [new Date('2024-04-15'), new Date('2024-04-30')],
      },
    },
    health: {
      title: '健康化灾',
      masterLanguage: '本月注意脾胃健康',
      immediate: [
        '注意饮食',
        '避免暴饮暴食',
        '早点休息',
        '多食黄色食物',
      ],
      shortTerm: [
        '定期体检',
        '多食黄色食物',
        '适当运动',
        '保持规律作息',
      ],
      longTerm: [
        '建立健康习惯',
        '购买健康保险',
        '定期检查',
        '锻炼身体',
      ],
      fortuneEnhancements: {
        rituals: [
          '佩戴黄色手串',
          '供奉黄财神',
          '多晒太阳',
        ],
        amulets: [
          '健康符',
          '平安符',
          '黄玉',
        ],
        colors: ['黄色', '棕色'],
        directions: ['东方', '东北方'],
        dates: [new Date('2024-03-21'), new Date('2024-04-05')],
      },
    },
  },
};

// 智能选择最佳话术
export const selectBestPhrase = (
  type: 'opening' | 'description' | 'judgment' | 'timing' | 'advice' | 'closing',
  context?: any
): string => {
  const phrases = MasterPhrases[type] as string[];
  
  // 如果是建议类型，根据上下文选择
  if (type === 'advice' && context) {
    if (context.category === 'career') {
      const careerAdvice = MasterPhrases.advice.career;
      if (context.specific) {
        return careerAdvice.specific[Math.floor(Math.random() * careerAdvice.specific.length)];
      }
      return careerAdvice.general[Math.floor(Math.random() * careerAdvice.general.length)];
    }
    if (context.category === 'wealth') {
      const wealthAdvice = MasterPhrases.advice.wealth;
      if (context.specific) {
        return wealthAdvice.specific[Math.floor(Math.random() * wealthAdvice.specific.length)];
      }
      return wealthAdvice.general[Math.floor(Math.random() * wealthAdvice.general.length)];
    }
  }
  
  // 默认随机选择
  return phrases[Math.floor(Math.random() * phrases.length)];
};

// 生成个性化话术
export const generatePersonalizedPhrase = (
  user: any,
  type: 'opening' | 'closing'
): string => {
  if (type === 'opening') {
    const openings = [
      `您好，${user.name}。从您的八字来看，日主为${user.bazi.dayMaster}，生于${user.bazi.pillars[1].earthlyBranch}月，这是一个${describeMonth(user.bazi.pillars[1])}的时令。`,
      `${user.name}，从您的八字来看，命局清奇，格局分明，乃富贵之命也。细观您的八字...`,
      `细观您的八字，日主为${user.bazi.dayMaster}，得令而旺，格局清正。从您的命局来看，${user.age}岁的经历与命理相符。`,
    ];
    return openings[Math.floor(Math.random() * openings.length)];
  }
  
  if (type === 'closing') {
    const closings = [
      `愿您，${user.name}，事业有成，家庭幸福，福寿绵长。`,
      `${user.name}，顺天应命，趋吉避凶，必有大成。望您善用命理优势，把握时机。`,
      `愿您，${user.name}，善用您的命理优势，在${user.age}岁大展宏图。命理虽定，人定胜天，勤勉努力。`,
    ];
    return closings[Math.floor(Math.random() * closings.length)];
  }
  
  return '';
};

// 辅助函数
function describeMonth(pillar: string): string {
  const descriptions = {
    '寅': '春季，万物复苏',
    '卯': '春季，生机盎然',
    '辰': '春季末尾，蓄势待发',
    '巳': '夏季初头，活力四射',
    '午': '夏季，热情奔放',
    '未': '夏季末尾，收获在即',
    '申': '秋季，清凉爽朗',
    '酉': '秋季，丰收喜悦',
    '戌': '秋季末尾，准备入冬',
    '亥': '冬季，蓄势待发',
    '子': '冬季初头，阴极阳生',
    '丑': '冬季，寒冷寂静',
  };
  
  return descriptions[pillar as any] || '平月';
}
